tags:
  - name: Finanzas Épicas
    description: Indicadores financieros omnicanal.

paths:
  /financial/daily-revenue:
    get:
      summary: 1.1 Venta Total del Día (Omnicanal)
      tags: [Finanzas Épicas]
      description: Suma de ventas entregadas (Delivery) y cerradas (Sala) del día actual.
      parameters:
        - in: query
          name: date
          schema:
            type: string
            example: 2026-02-01
          description: Fecha opcional (YYYY-MM-DD).
      responses:
        200:
          description: Éxito
          content:
            application/json:
              schema:
                type: object
                properties:
                  date_range:
                    type: object
                    properties:
                      start:
                        type: string
                      end:
                        type: string
                  daily_revenue:
                    type: object
                    properties:
                      total:
                        type: number
                        example: 4520.0
                      delivery:
                        type: number
                        example: 2500.0
                      dine_in:
                        type: number
                        example: 2020.0
  /financial/aov:
    get:
      summary: 1.2 Ticket Promedio Global (AOV)
      tags: [Finanzas Épicas]
      description: Promedio de gasto por cliente unificando todos los canales.
      parameters:
        - in: query
          name: date
          schema:
            type: string
            example: 2026-02-01
          description: Fecha opcional (YYYY-MM-DD).
      responses:
        200:
          description: Éxito
          content:
            application/json:
              schema:
                type: object
                properties:
                  average_ticket:
                    type: object
                    properties:
                      value:
                        type: number
                        example: 25.5
                      total_revenue:
                        type: number
                        example: 4520.0
                      total_orders:
                        type: integer
                        example: 177
  /financial/lost-revenue:
    get:
      summary: 1.3 Costo de Oportunidad (Dinero Perdido)
      tags: [Finanzas Épicas]
      description: Suma de ventas perdidas por cancelaciones en delivery o rechazos en cocina.
      parameters:
        - in: query
          name: date
          schema:
            type: string
            example: 2026-02-01
          description: Fecha opcional (YYYY-MM-DD).
      responses:
        200:
          description: Éxito
          content:
            application/json:
              schema:
                type: object
                properties:
                  lost_revenue:
                    type: object
                    properties:
                      total_estimated:
                        type: number
                        example: 150.0
                      delivery_cancelled:
                        type: number
                        example: 100.0
                      kitchen_rejected_estimated:
                        type: number
                        example: 50.0
  /financial/revenue-series:
    get:
      summary: 1.4 Historial de Ingresos (Revenue Series)
      tags: [Finanzas Épicas]
      description: Retorna ingresos históricos agrupados por día o mes.
      parameters:
        - in: query
          name: from
          schema:
            type: string
            example: 2026-02-01
          description: Fecha inicio (YYYY-MM-DD).
          required: true
        - in: query
          name: to
          schema:
            type: string
            example: 2026-02-07
          description: Fecha fin (YYYY-MM-DD).
          required: true
        - in: query
          name: groupBy
          schema:
            type: string
            example: day
          description: day (por día) o month (por mes).
          required: true
      responses:
        200:
          description: Éxito
          content:
            application/json:
              schema:
                type: object
                properties:
                  series:
                    type: array
                    items:
                      type: object
                      properties:
                        label:
                          type: string
                          example: 2026-02-01
                        delivery:
                          type: number
                          example: 120.5
                        dine_in:
                          type: number
                          example: 85.0
                        total:
                          type: number
                          example: 205.5
                  summary:
                    type: object
                    properties:
                      total_period:
                        type: number
                        example: 2306.75
                      best_day:
                        type: string
                        example: 2026-02-07
                      avg_daily:
                        type: number
                        example: 329.53
                  sources:
                    type: object
                    properties:
                      dp:
                        type: object
                        properties:
                          ok:
                            type: boolean
                          status:
                            type: integer
                          cache:
                            type: string
                      atc:
                        type: object
                        properties:
                          ok:
                            type: boolean
                          status:
                            type: integer
                          cache:
                            type: string
